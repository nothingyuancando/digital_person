<!DOCTYPE html>
<html>
<body>
  <h2>课程文件上传</h2>
  <input type="file" id="fileInput">
  <button onclick="uploadFile()">上传文件</button>
  
  <div id="progress" style="display:none;">
    <progress value="0" max="100"></progress>
    <span id="progressText">0%</span>
  </div>

  <script>
    async function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      
      const formData = new FormData();
      formData.append('file', file);
      formData.append('courseId', 'CS101');

      try {
        const response = await fetch('/api/course/upload', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        if (result.status === 'success') {
          startProgressPolling(result.processId);
        }
      } catch (error) {
        console.error('上传失败:', error);
      }
    }

    function startProgressPolling(processId) {
      document.getElementById('progress').style.display = 'block';
      const progressBar = document.querySelector('progress');
      const progressText = document.getElementById('progressText');
      
      const interval = setInterval(async () => {
        const response = await fetch(`/api/course/process-status?processId=${processId}`);
        const data = await response.json();
        
        progressBar.value = data.progress;
        progressText.textContent = `${data.progress}%`;
        
        if (data.status === 'success' || data.status === 'failed') {
          clearInterval(interval);
          alert(`处理完成，状态：${data.status}`);
        }
      }, 2000);
    }
  </script>
</body>
</html>